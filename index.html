<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>TXT ⇄ M3U 转换（支持全能繁→简）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- OpenCC（全能繁体 → 简体） -->
<script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/opencc.min.js"></script>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    background: #f5f5f5;
    margin: 0;
    padding: 15px;
}
.container {
    max-width: 1000px;
    margin: auto;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
}
h2 { margin-top: 0; }
textarea {
    width: 100%;
    height: 240px;
    box-sizing: border-box;
    margin: 10px 0;
    padding: 10px;
    font-family: Consolas, monospace;
}
.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
}
button {
    padding: 8px 14px;
    cursor: pointer;
}
.switch {
    display: flex;
    align-items: center;
    gap: 6px;
}
.footer {
    margin-top: 10px;
    font-size: 13px;
    color: #666;
}
</style>
</head>

<body>
<div class="container">
    <h2>TXT ⇄ M3U 转换工具</h2>

    <div class="controls">
        <input type="file" id="fileInput" accept=".txt,.m3u,.m3u8">
        <button onclick="txtToM3u()">TXT → M3U</button>
        <button onclick="m3uToTxt()">M3U → TXT</button>
        <button onclick="download()">下载结果</button>

        <div class="switch">
            <input type="checkbox" id="enableTc2Sc" checked>
            <label>启用 繁体 → 简体（全能）</label>
        </div>
    </div>

    <textarea id="input" placeholder="输入 / 上传 TXT 或 M3U 内容"></textarea>
    <textarea id="output" placeholder="转换结果"></textarea>

    <div class="footer">
        ✔ 纯浏览器使用 ｜ ✔ 支持 GitHub Pages ｜ ✔ OpenCC 全量繁转简
    </div>
</div>

<script>
/* =======================
   文件读取
   ======================= */
document.getElementById('fileInput').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        document.getElementById('input').value = reader.result;
    };
    reader.readAsText(file, 'utf-8');
});

/* =======================
   OpenCC 全能繁 → 简
   ======================= */
let openccConverter = null;

function tc2sc(text) {
    const enable = document.getElementById('enableTc2Sc');
    if (!enable || !enable.checked) return text;

    if (!openccConverter) {
        openccConverter = OpenCC.Converter({ from: 't', to: 's' });
    }
    return openccConverter(text);
}

/* =======================
   TXT → M3U
   支持：频道名,URL
   ======================= */
function txtToM3u() {
    const input = document.getElementById('input').value;
    if (!input.trim()) return;

    const lines = input.split(/\r?\n/);
    let out = '#EXTM3U\n';

    lines.forEach(line => {
        line = line.trim();
        if (!line || line.startsWith('#')) return;

        const parts = line.split(',');
        if (parts.length < 2) return;

        const name = tc2sc(parts[0].trim());
        const url = parts.slice(1).join(',').trim();

        out += `#EXTINF:-1,${name}\n${url}\n`;
    });

    document.getElementById('output').value = out.trim();
}

/* =======================
   M3U → TXT
   ======================= */
function m3uToTxt() {
    const input = document.getElementById('input').value;
    if (!input.trim()) return;

    const lines = input.split(/\r?\n/);
    let name = '';
    let out = [];

    lines.forEach(line => {
        line = line.trim();
        if (line.startsWith('#EXTINF')) {
            name = line.split(',').pop().trim();
            name = tc2sc(name);
        } else if (line && !line.startsWith('#') && name) {
            out.push(`${name},${line}`);
            name = '';
        }
    });

    document.getElementById('output').value = out.join('\n');
}

/* =======================
   下载结果
   ======================= */
function download() {
    const text = document.getElementById('output').value;
    if (!text.trim()) return;

    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'result.txt';
    a.click();
    URL.revokeObjectURL(a.href);
}
</script>
</body>
</html>
