<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV å·¥å…·é›† V2ï¼ˆæµè§ˆå™¨ç‰ˆï¼‰</title>

<!-- OpenCC ç¹ä½“è½¬ç®€ä½“ -->
<script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/browser.min.js"></script>

<style>
body{background:#f5f5f5;font-family:-apple-system,BlinkMacSystemFont,"PingFang SC",Arial}
.container{max-width:960px;margin:20px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.08)}
h1{text-align:center;font-size:20px;margin-bottom:20px}
.panel{border:1px solid #eee;border-radius:10px;padding:15px;margin-bottom:20px}
.panel h3{margin-bottom:10px;font-size:16px}
input,textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd}
button{background:#1677ff;color:#fff;border:none;cursor:pointer}
button.gray{background:#666}
.flex{display:flex;gap:10px;flex-wrap:wrap}
.logo-item{display:flex;align-items:center;gap:10px;border-bottom:1px solid #eee;padding:8px 0}
.logo-item img{width:80px;height:40px;object-fit:contain;border:1px solid #eee}
.small{font-size:12px;color:#666}
</style>
</head>

<body>
<div class="container">
<h1>ğŸ“º IPTV å·¥å…·é›† V2ï¼ˆæµè§ˆå™¨å¯ç”¨ï¼‰</h1>

<!-- LOGO æœç´¢ -->
<div class="panel">
<h3>LOGO æ¨¡ç³Šæœç´¢</h3>
<div class="flex">
<input id="searchKey" placeholder="å¦‚ï¼šNOW æ˜Ÿå½± / ç¿¡ç¿  / CCTV / Movie">
<button onclick="searchLogo()">æœç´¢</button>
</div>
<div id="logoResult"></div>
</div>

<!-- è½¬æ¢ -->
<div class="panel">
<h3>TXT â‡„ M3U è½¬æ¢</h3>
<input type="file" accept=".txt,.m3u,.m3u8" onchange="loadFile(this)">
<textarea id="input" placeholder="ç²˜è´´æˆ–ä¸Šä¼ å†…å®¹"></textarea>
<div class="flex">
<button onclick="txtToM3u()">TXT â†’ M3U</button>
<button onclick="m3uToTxt()">M3U â†’ TXT</button>
<button class="gray" onclick="clearAll()">æ¸…ç©º</button>
</div>
<textarea id="output" placeholder="è¾“å‡ºç»“æœ"></textarea>
</div>

</div>

<script>
/* ===== åŸºç¡€é…ç½® ===== */
const repoOwner="1996TV";
const repoName="LOGO";
const cdnBase=`https://cdn.jsdelivr.net/gh/${repoOwner}/${repoName}@main/`;
const opencc=OpenCC.Converter({from:'t',to:'s'});

let logoFiles=[];

/* ===== åˆ«åæ˜ å°„ï¼ˆé‡ç‚¹ï¼‰ ===== */
const ALIAS_MAP={
"NOWæ˜Ÿå½±å°":"NOWæ˜Ÿå½±",
"NOW æ˜Ÿå½±å°":"NOWæ˜Ÿå½±",
"NOW Movie":"NOWæ˜Ÿå½±",
"ç¿¡ç¿ å°":"ç¿¡ç¿ å°",
"ç„¡ç¶«æ–°èå°":"æ— çº¿æ–°é—»",
"æ— çº¿æ–°é—»å°":"æ— çº¿æ–°é—»",
"HOY TV":"HOYèµ„è®¯",
"æœ¬æ¸¯å°":"æœ¬æ¸¯å°"
};

/* ===== å·¥å…·å‡½æ•° ===== */
function toSimple(t){return opencc(t||"")}
function normalize(name){
name=toSimple(name).replace(/é«˜æ¸…|HD|è¶…æ¸…|4K/ig,"").trim();
return ALIAS_MAP[name]||name;
}

/* ===== é€’å½’è¯»å– LOGO ä»“åº“ ===== */
async function loadLogos(path=""){
const api=`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
const res=await fetch(api);
const data=await res.json();
for(const f of data){
if(f.type==="file" && f.name.endsWith(".png")){
logoFiles.push({name:f.name.replace(".png",""),url:cdnBase+f.path});
}
if(f.type==="dir") await loadLogos(f.path);
}
}

/* ===== LOGO æœç´¢ ===== */
async function searchLogo(){
const key=toSimple(document.getElementById("searchKey").value.trim());
if(!key)return;
if(!logoFiles.length) await loadLogos();
const res=logoFiles.filter(l=>l.name.toLowerCase().includes(key.toLowerCase()));
const box=document.getElementById("logoResult");
box.innerHTML=res.length?res.map(l=>`
<div class="logo-item">
<img src="${l.url}">
<div>
<div>${l.name}</div>
<div class="small">${l.url}</div>
</div>
</div>`).join(""):"<p class='small'>æœªæ‰¾åˆ°</p>";
}

/* ===== æ–‡ä»¶ ===== */
function loadFile(i){
const f=i.files[0];if(!f)return;
const r=new FileReader();
r.onload=e=>input.value=e.target.result;
r.readAsText(f);
}

/* ===== TXT â†’ M3U ===== */
function txtToM3u(){
let t=toSimple(input.value.trim());
let out="#EXTM3U\n";
t.split("\n").forEach(l=>{
if(!l.includes(","))return;
let [n,u]=l.split(",");
n=normalize(n);
out+=`#EXTINF:-1 tvg-logo="${cdnBase}${n}.png",${n}\n${u}\n`;
});
output.value=out;
}

/* ===== M3U â†’ TXT ===== */
function m3uToTxt(){
let t=toSimple(input.value.trim()).split("\n");
let out="";
for(let i=0;i<t.length;i++){
if(t[i].startsWith("#EXTINF")){
let name=t[i].split(",").pop();
name=normalize(name);
let url=t[i+1]||"";
out+=`${name},${url}\n`;
i++;
}
}
output.value=out;
}

function clearAll(){input.value="";output.value=""}
</script>
</body>
</html>
