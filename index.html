<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>IPTV工具集 - LOGO模糊搜索</title>

    <!-- 【新增】OpenCC 繁体转简体（浏览器版） -->
    <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/browser.min.js"></script>

    <style>
        /* ===== 原样保留 ===== */
        * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"PingFang SC",Arial,sans-serif;}
        body { background:#f5f5f5; padding:15px; }
        .container { background:#fff; padding:20px 15px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08);}
        h1 { font-size:18px; text-align:center; margin-bottom:20px;}
        textarea,input,button { width:100%; padding:12px; margin:6px 0; border-radius:8px; border:1px solid #ddd;}
        button { background:#1677ff; color:#fff; border:none; cursor:pointer;}
        .btn-group { display:flex; gap:8px; flex-wrap:wrap;}
    </style>
</head>

<body>
<div class="container">
    <h1>IPTV工具集 - LOGO模糊搜索</h1>

    <input type="file" id="fileInput" accept=".txt,.m3u,.m3u8" onchange="readFile(this)">
    <textarea id="inputContent" placeholder="粘贴或上传 TXT / M3U 内容"></textarea>

    <div class="btn-group">
        <button onclick="txtToM3u()">TXT → M3U</button>
        <button onclick="m3uToTxt()">M3U → TXT</button>
        <button onclick="clearAll()">清空</button>
    </div>

    <textarea id="output" placeholder="处理结果" readonly></textarea>
</div>

<script>
/* ================================
   【新增】繁体 → 简体 支持
================================ */
const opencc = OpenCC.Converter({ from: 't', to: 's' });

function toSimplified(text) {
    if (!text) return text;
    try {
        return opencc(text);
    } catch (e) {
        console.error('繁体转简体失败', e);
        return text;
    }
}

/* ===== 原有：读取文件（不改） ===== */
function readFile(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        document.getElementById('inputContent').value = e.target.result;
    };
    reader.readAsText(file);
}

/* ===== TXT → M3U（仅加一行繁转简） ===== */
function txtToM3u() {
    let input = document.getElementById('inputContent').value.trim();
    if (!input) return alert('请输入TXT内容！');

    //【新增】繁体 → 简体
    input = toSimplified(input);

    const lines = input.split('\n');
    let output = '#EXTM3U\n';

    lines.forEach(line => {
        line = line.trim();
        if (!line || !line.includes(',')) return;
        const [name, url] = line.split(',');
        output += `#EXTINF:-1,${name}\n${url}\n`;
    });

    document.getElementById('output').value = output;
}

/* ===== M3U → TXT（仅加一行繁转简） ===== */
function m3uToTxt() {
    let input = document.getElementById('inputContent').value.trim();
    if (!input) return alert('请输入M3U内容！');

    //【新增】繁体 → 简体
    input = toSimplified(input);

    const lines = input.split('\n');
    let output = '';

    for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith('#EXTINF')) {
            const name = lines[i].split(',').pop();
            const url = lines[i + 1] || '';
            output += `${name},${url}\n`;
            i++;
        }
    }

    document.getElementById('output').value = output;
}

function clearAll() {
    document.getElementById('inputContent').value = '';
    document.getElementById('output').value = '';
}
</script>
</body>
</html>
